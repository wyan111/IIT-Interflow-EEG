%bipolar re-referencing
channel_data = load('ch170722.mat');
data = channel_data.EEG_all;
BR_data = {};
for i = 1:6
    for j = 1:6
        ch_d = cell2mat(data(i,j));
        br_d = [];
        %left
        br_d(1,:,:) = ch_d(6,:,:)-ch_d(5,:,:);
        br_d(2,:,:) = ch_d(8,:,:)-ch_d(7,:,:);
        br_d(3,:,:) = ch_d(10,:,:)-ch_d(9,:,:);
        br_d(4,:,:) = ch_d(12,:,:)-ch_d(11,:,:);
        br_d(5,:,:) = ch_d(13,:,:)-ch_d(14,:,:);
        br_d(6,:,:) = ch_d(15,:,:)-ch_d(16,:,:);
        br_d(7,:,:) = ch_d(17,:,:)-ch_d(18,:,:);
        br_d(8,:,:) = ch_d(90,:,:)-ch_d(89,:,:);
        br_d(9,:,:) = ch_d(92,:,:)-ch_d(91,:,:);
        br_d(10,:,:) = ch_d(93,:,:)-ch_d(94,:,:);
        br_d(11,:,:) = ch_d(95,:,:)-ch_d(96,:,:);
        br_d(12,:,:) = ch_d(99,:,:)-ch_d(88,:,:);
        br_d(13,:,:) = ch_d(101,:,:)-ch_d(100,:,:);
        br_d(14,:,:) = ch_d(103,:,:)-ch_d(102,:,:);
        br_d(15,:,:) = ch_d(104,:,:)-ch_d(119,:,:);
        br_d(16,:,:) = ch_d(105,:,:)-ch_d(106,:,:);
        br_d(17,:,:) = ch_d(107,:,:)-ch_d(108,:,:);
        br_d(18,:,:) = ch_d(109,:,:)-ch_d(98,:,:);
        br_d(19,:,:) = ch_d(112,:,:)-ch_d(111,:,:);
        br_d(20,:,:) = ch_d(114,:,:)-ch_d(110,:,:);
        br_d(21,:,:) = ch_d(116,:,:)-ch_d(115,:,:);
        br_d(22,:,:) = ch_d(118,:,:)-ch_d(117,:,:);
        br_d(23,:,:) = ch_d(120,:,:)-ch_d(121,:,:);
        br_d(24,:,:) = ch_d(123,:,:)-ch_d(122,:,:);
        br_d(25,:,:) = ch_d(124,:,:)-ch_d(113,:,:);
        br_d(26,:,:) = ch_d(126,:,:)-ch_d(125,:,:);
        br_d(27,:,:) = ch_d(128,:,:)-ch_d(127,:,:);
        %Middle line
        br_d(28,:,:) = ch_d(2,:,:)-ch_d(1,:,:);
        br_d(29,:,:) = ch_d(4,:,:)-ch_d(3,:,:);
        br_d(30,:,:) = ch_d(20,:,:)-ch_d(19,:,:);
        br_d(31,:,:) = ch_d(22,:,:)-ch_d(21,:,:);
        br_d(32,:,:) = ch_d(24,:,:)-ch_d(23,:,:);
        br_d(33,:,:) = ch_d(86,:,:)-ch_d(87,:,:);
        br_d(34,:,:) = ch_d(84,:,:)-ch_d(85,:,:);
        br_d(35,:,:) = ch_d(82,:,:)-ch_d(83,:,:);
        br_d(36,:,:) = ch_d(97,:,:)-ch_d(65,:,:);
        %Right
        br_d(37,:,:) = ch_d(26,:,:)-ch_d(27,:,:);
        br_d(38,:,:) = ch_d(28,:,:)-ch_d(29,:,:);
        br_d(39,:,:) = ch_d(30,:,:)-ch_d(31,:,:);
        br_d(40,:,:) = ch_d(34,:,:)-ch_d(33,:,:);
        br_d(41,:,:) = ch_d(35,:,:)-ch_d(32,:,:);
        br_d(42,:,:) = ch_d(37,:,:)-ch_d(36,:,:);
        br_d(43,:,:) = ch_d(39,:,:)-ch_d(38,:,:);
        br_d(44,:,:) = ch_d(41,:,:)-ch_d(40,:,:);
        br_d(45,:,:) = ch_d(42,:,:)-ch_d(43,:,:);
        br_d(46,:,:) = ch_d(44,:,:)-ch_d(45,:,:);
        br_d(47,:,:) = ch_d(46,:,:)-ch_d(47,:,:);
        br_d(48,:,:) = ch_d(49,:,:)-ch_d(48,:,:);
        br_d(49,:,:) = ch_d(50,:,:)-ch_d(51,:,:);
        br_d(50,:,:) = ch_d(53,:,:)-ch_d(52,:,:);
        br_d(51,:,:) = ch_d(55,:,:)-ch_d(54,:,:);
        br_d(52,:,:) = ch_d(57,:,:)-ch_d(56,:,:);
        br_d(53,:,:) = ch_d(59,:,:)-ch_d(58,:,:);
        br_d(54,:,:) = ch_d(60,:,:)-ch_d(61,:,:);
        br_d(55,:,:) = ch_d(62,:,:)-ch_d(63,:,:);
        br_d(56,:,:) = ch_d(64,:,:)-ch_d(66,:,:);
        br_d(57,:,:) = ch_d(67,:,:)-ch_d(75,:,:);
        br_d(58,:,:) = ch_d(69,:,:)-ch_d(68,:,:);
        br_d(59,:,:) = ch_d(71,:,:)-ch_d(70,:,:);
        br_d(60,:,:) = ch_d(73,:,:)-ch_d(74,:,:);
        br_d(61,:,:) = ch_d(77,:,:)-ch_d(76,:,:);
        br_d(62,:,:) = ch_d(79,:,:)-ch_d(78,:,:);
        br_d(63,:,:) = ch_d(80,:,:)-ch_d(72,:,:);
        BR_data(i,j) = {br_d};
    end
end
save('brch170722.mat','BR_data')
